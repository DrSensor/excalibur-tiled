!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("excalibur")):"function"==typeof define&&define.amd?define(["excalibur"],e):"object"==typeof exports?exports["Extensions.Tiled"]=e(require("excalibur")):t["Extensions.Tiled"]=e(t.ex)}(this,function(t){return function(t){function e(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var a,n=r(1);!function(t){t[t.TMX=0]="TMX",t[t.JSON=1]="JSON"}(a=e.TiledMapFormat||(e.TiledMapFormat={}));var o=function(t){function e(e,r){void 0===r&&(r=a.JSON);var i=this;switch(r){case a.JSON:i=t.call(this,e,"application/json")||this;break;default:throw"The format "+r+" is not currently supported. Please export Tiled map as JSON."}return i.mapFormat=r,i.imagePathAccessor=function(t){if(0===t.indexOf("/"))return t;var r=e.split("/"),i=r.concat([]);return r.length>0&&i.splice(-1),i.push(t),i.join("/")},i}return i(e,t),e.prototype.load=function(){var e=this,r=new n.Promise;return t.prototype.load.call(this).then(function(t){var i=[];e.data.tilesets.forEach(function(t){var r=new n.Texture(e.imagePathAccessor(t.image,t));t.imageTexture=r,i.push(r.load()),n.Logger.getInstance().debug("[Tiled] Loading associated tileset: "+t.image)}),n.Promise.join.apply(e,i).then(function(){r.resolve(t)},function(t){r.reject(t)})}),r},e.prototype.processData=function(t){if("string"!=typeof t)throw"Tiled map resource "+this.path+" is not the correct content type";if(void 0===t)throw"Tiled map resource "+this.path+" is empty";switch(this.mapFormat){case a.JSON:return s(t)}},e.prototype.getTilesetForTile=function(t){for(var e=this.data.tilesets.length-1;e>=0;e--){var r=this.data.tilesets[e];if(r.firstgid<=t)return r}return null},e.prototype.getTileMap=function(){for(var t=new n.TileMap(0,0,this.data.tilewidth,this.data.tileheight,this.data.height,this.data.width),e=0,r=this.data.tilesets;e<r.length;e++){var i=r[e],a=Math.floor(i.imagewidth/i.tilewidth),o=Math.floor(i.imageheight/i.tileheight),s=new n.SpriteSheet(i.imageTexture,a,o,i.tilewidth,i.tileheight);t.registerSpriteSheet(i.firstgid.toString(),s)}for(var c=0,h=this.data.layers;c<h.length;c++){var u=h[c];if("tilelayer"===u.type)for(var l=0;l<u.data.length;l++){var f=u.data[l];if(0!==f){var i=this.getTilesetForTile(f);t.data[l].sprites.push(new n.TileSprite(i.firstgid.toString(),f-i.firstgid))}}}return t},e}(n.Resource);e.default=o;var s=function(t){var e=JSON.parse(t);if(e.layers)for(var r=0,i=e.layers;r<i.length;r++){var a=i[r];"string"==typeof a.data?"base64"===a.encoding&&(a.data=c.decompressBase64(a.data,a.encoding)):a.data=c.decompressCsv(a.data)}return e},c={decompressCsv:function(t){return t},decompressBase64:function(t,e){function r(t){var e=t.charCodeAt(0);return e===l||e===v?62:e===f||e===y?63:e<p?-1:e<p+10?e-p+26+26:e<g+26?e-g:e<d+26?e-d+26:void 0}function i(t){h[A++]=t}var a,n,o,s,c,h;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u="undefined"!=typeof Uint8Array?Uint8Array:Array,l="+".charCodeAt(0),f="/".charCodeAt(0),p="0".charCodeAt(0),d="a".charCodeAt(0),g="A".charCodeAt(0),v="-".charCodeAt(0),y="_".charCodeAt(0),m=t.length;c="="===t.charAt(m-2)?2:"="===t.charAt(m-1)?1:0,h=new u(3*t.length/4-c),o=c>0?t.length-4:t.length;var A=0;for(a=0,n=0;a<o;a+=4,n+=3)s=r(t.charAt(a))<<18|r(t.charAt(a+1))<<12|r(t.charAt(a+2))<<6|r(t.charAt(a+3)),i((16711680&s)>>16),i((65280&s)>>8),i(255&s);2===c?(s=r(t.charAt(a))<<2|r(t.charAt(a+1))>>4,i(255&s)):1===c&&(s=r(t.charAt(a))<<10|r(t.charAt(a+1))<<4|r(t.charAt(a+2))>>2,i(s>>8&255),i(255&s));var w=h.length/4,x=new Array(w);for(a=0;a<w;a++)x[a]=function(t){for(var e=0,r=t.length-1;r>=0;r--)e=256*e+1*t[r];return e}(h.slice(4*a,4*a+3));return x}}},function(e,r){e.exports=t}])});
//# sourceMappingURL=excalibur-tiled.min.js.map